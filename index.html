<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Formula Practice</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            padding: 40px;
        }

        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .stats-bar {
            display: flex;
            justify-content: space-around;
            background: #f0f4ff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            color: #667eea;
            font-weight: bold;
        }

        .timer {
            color: #764ba2;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-group label {
            font-size: 0.95em;
            color: #333;
            font-weight: 600;
        }

        select {
            padding: 10px 15px;
            font-size: 1em;
            border: 2px solid #667eea;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            min-width: 200px;
        }

        select:focus {
            outline: none;
            border-color: #764ba2;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 1em;
            cursor: pointer;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #6c757d;
        }

        button.success {
            background: #28a745;
        }

        .questions-container {
            margin-top: 30px;
            display: none;
        }

        .question {
            background: #f8f9fa;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .question-text {
            font-size: 1.1em;
            color: #333;
            font-weight: 500;
            flex: 1;
        }

        .hint-button {
            padding: 6px 12px;
            font-size: 0.85em;
            margin: 0;
            background: #ffc107;
            color: #333;
        }

        .hint-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            display: none;
        }

        .hint-box.show {
            display: block;
        }

        .hint-box strong {
            color: #856404;
        }

        .answer-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="number"] {
            padding: 10px;
            font-size: 1em;
            border: 2px solid #ddd;
            border-radius: 6px;
            width: 150px;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .unit {
            color: #666;
            font-weight: 600;
        }

        .feedback {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 5px;
            font-weight: 600;
            display: none;
        }

        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .button-container {
            text-align: center;
            margin-top: 30px;
        }

        .score-container {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 10px;
            display: none;
        }

        .score-container h2 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .score {
            font-size: 2em;
            color: #764ba2;
            font-weight: bold;
        }

        .formula-reference {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
            display: none;
        }

        .formula-reference h3 {
            color: #856404;
            margin-bottom: 8px;
        }

        .formula-reference p {
            color: #856404;
            font-size: 1.1em;
            font-weight: 600;
        }

        .units-choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .unit-choice {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.2s;
        }

        .unit-choice:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(102, 126, 234, 0.2);
        }

        .unit-choice.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .unit-choice.correct {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .unit-choice.incorrect {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
                padding: 20px;
            }
            .controls-row, .button-container, .stats-bar, .hint-button {
                display: none !important;
            }
            .question {
                page-break-inside: avoid;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }
            h1 {
                font-size: 2em;
            }
            select {
                min-width: 100%;
            }
            .controls-row {
                flex-direction: column;
            }
            .stats-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Physics Formula Practice</h1>
        <p class="subtitle">Master physics formulas with interactive practice</p>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-label">Questions Today</div>
                <div class="stat-value" id="questionsToday">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Correct Today</div>
                <div class="stat-value" id="correctToday">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Accuracy</div>
                <div class="stat-value" id="accuracy">0%</div>
            </div>
            <div class="stat-item" id="timerDisplay" style="display: none;">
                <div class="stat-label">Time Elapsed</div>
                <div class="stat-value timer" id="timerValue">0:00</div>
            </div>
        </div>

        <div style="text-align: center; margin-bottom: 20px;">
            <button id="practiceModeBtn" onclick="switchMode('practice')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">Practice Mode (5 Questions)</button>
            <button id="worksheetModeBtn" onclick="switchMode('worksheet')" style="background: #6c757d;">Worksheet Mode (10 Questions)</button>
            <button id="unitsModeBtn" onclick="switchMode('units')" style="background: #6c757d;">Units Practice</button>
        </div>

        <div class="controls-row">
            <div class="control-group">
                <label for="formula">Choose Formula:</label>
                <select id="formula">
                    <option value="">-- Select a Formula --</option>
                    <option value="fma">F = ma (Force)</option>
                    <option value="pmv">p = mv (Momentum)</option>
                    <option value="dst">d = st (Distance)</option>
                    <option value="vat">v = at (Velocity)</option>
                    <option value="wfd">W = Fd (Work)</option>
                    <option value="ke">KE = ¬Ωmv¬≤ (Kinetic Energy)</option>
                    <option value="pe">PE = mgh (Potential Energy)</option>
                    <option value="pwt">P = W/t (Power)</option>
                    <option value="advt">a = Œîv/t (Acceleration)</option>
                    <option value="density">œÅ = m/V (Density)</option>
                    <option value="wave">v = fŒª (Wave Speed)</option>
                    <option value="period">T = 1/f (Period)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="difficulty">Difficulty Level:</label>
                <select id="difficulty">
                    <option value="easy">Easy (Whole Numbers)</option>
                    <option value="medium" selected>Medium (Decimals)</option>
                    <option value="hard">Hard (Mixed)</option>
                </select>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="timerToggle">
                <label for="timerToggle">Enable Timer</label>
            </div>
        </div>

        <div class="button-container">
            <button id="generateBtn" onclick="generateQuestions()">Generate Questions</button>
            <button class="secondary" onclick="printWorksheet()" id="printBtn">Print Worksheet</button>
        </div>

        <div class="formula-reference" id="formulaRef"></div>

        <div class="questions-container" id="questionsContainer"></div>

        <div class="button-container" id="checkBtnContainer" style="display: none;">
            <button id="checkBtn" onclick="checkAnswers()">Check Answers</button>
            <button onclick="generateQuestions()">Try New Questions</button>
            <button class="secondary" onclick="resetStats()">Reset Stats</button>
        </div>

        <div class="score-container" id="scoreContainer">
            <h2>Your Score</h2>
            <div class="score" id="score"></div>
        </div>
    </div>

    <script>
        let currentQuestions = [];
        let currentFormula = '';
        let timerInterval = null;
        let timerSeconds = 0;
        let currentMode = 'practice'; // 'practice', 'worksheet', or 'units'
        let stats = {
            questionsToday: 0,
            correctToday: 0
        };

        function switchMode(mode) {
            currentMode = mode;
            const practiceBtn = document.getElementById('practiceModeBtn');
            const worksheetBtn = document.getElementById('worksheetModeBtn');
            const unitsBtn = document.getElementById('unitsModeBtn');
            const generateBtn = document.getElementById('generateBtn');
            const printBtn = document.getElementById('printBtn');
            const timerCheckbox = document.getElementById('timerToggle');
            const timerCheckboxContainer = timerCheckbox.parentElement;
            const formulaSelect = document.getElementById('formula').parentElement.parentElement;
            const difficultySelect = document.getElementById('difficulty').parentElement.parentElement;

            // Reset all buttons to gray
            practiceBtn.style.background = '#6c757d';
            worksheetBtn.style.background = '#6c757d';
            unitsBtn.style.background = '#6c757d';

            if (mode === 'practice') {
                practiceBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                generateBtn.textContent = 'Generate 5 Questions';
                printBtn.style.display = 'inline-block';
                timerCheckboxContainer.style.display = 'flex';
                formulaSelect.style.display = 'flex';
                difficultySelect.style.display = 'flex';
            } else if (mode === 'worksheet') {
                worksheetBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                generateBtn.textContent = 'Generate 10 Questions';
                printBtn.style.display = 'none';
                timerCheckboxContainer.style.display = 'none';
                formulaSelect.style.display = 'flex';
                difficultySelect.style.display = 'flex';
            } else if (mode === 'units') {
                unitsBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                generateBtn.textContent = 'Generate 10 Units Questions';
                printBtn.style.display = 'none';
                timerCheckboxContainer.style.display = 'none';
                formulaSelect.style.display = 'none';
                difficultySelect.style.display = 'none';
            }

            // Clear any existing questions
            document.getElementById('questionsContainer').innerHTML = '';
            document.getElementById('questionsContainer').style.display = 'none';
            document.getElementById('checkBtnContainer').style.display = 'none';
            document.getElementById('scoreContainer').style.display = 'none';
            document.getElementById('formulaRef').style.display = 'none';
            stopTimer();
        }

        // Load stats from localStorage
        function loadStats() {
            const today = new Date().toDateString();
            const savedStats = localStorage.getItem('ipc-stats');
            const savedDate = localStorage.getItem('ipc-stats-date');
            
            if (savedDate === today && savedStats) {
                stats = JSON.parse(savedStats);
            } else {
                stats = { questionsToday: 0, correctToday: 0 };
                localStorage.setItem('ipc-stats-date', today);
            }
            updateStatsDisplay();
        }

        function saveStats() {
            localStorage.setItem('ipc-stats', JSON.stringify(stats));
        }

        function updateStatsDisplay() {
            document.getElementById('questionsToday').textContent = stats.questionsToday;
            document.getElementById('correctToday').textContent = stats.correctToday;
            const accuracy = stats.questionsToday > 0 
                ? Math.round((stats.correctToday / stats.questionsToday) * 100) 
                : 0;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        function resetStats() {
            if (confirm('Are you sure you want to reset your progress stats?')) {
                stats = { questionsToday: 0, correctToday: 0 };
                saveStats();
                updateStatsDisplay();
            }
        }

        function startTimer() {
            const timerEnabled = document.getElementById('timerToggle').checked;
            if (!timerEnabled) return;

            timerSeconds = 0;
            document.getElementById('timerDisplay').style.display = 'block';
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timerSeconds++;
                updateTimerDisplay();
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerValue').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function generateQuestions() {
            const formulaSelect = document.getElementById('formula');
            currentFormula = formulaSelect.value;

            if (currentMode !== 'units' && !currentFormula) {
                alert('Please select a formula first!');
                return;
            }

            stopTimer();
            currentQuestions = [];
            const questionsContainer = document.getElementById('questionsContainer');
            const scoreContainer = document.getElementById('scoreContainer');
            const checkBtnContainer = document.getElementById('checkBtnContainer');
            const formulaRef = document.getElementById('formulaRef');

            questionsContainer.innerHTML = '';
            scoreContainer.style.display = 'none';

            if (currentMode === 'units') {
                // Generate units matching questions
                generateUnitsQuestions();
                return;
            }

            // Show formula reference for practice/worksheet modes
            formulaRef.style.display = 'block';
            const formulaTexts = {
                'fma': 'F = ma (Force = mass √ó acceleration)',
                'pmv': 'p = mv (momentum = mass √ó velocity)',
                'dst': 'd = st (distance = speed √ó time)',
                'vat': 'v = at (velocity = acceleration √ó time)',
                'wfd': 'W = Fd (Work = Force √ó distance)',
                'ke': 'KE = ¬Ωmv¬≤ (Kinetic Energy)',
                'pe': 'PE = mgh (Potential Energy)',
                'pwt': 'P = W/t (Power = Work / time)',
                'advt': 'a = Œîv/t (acceleration = change in velocity / time)',
                'density': 'œÅ = m/V (Density = mass / volume)',
                'wave': 'v = fŒª (wave speed = frequency √ó wavelength)',
                'period': 'T = 1/f (period = 1 / frequency)'
            };
            formulaRef.innerHTML = `<h3>Formula:</h3><p>${formulaTexts[currentFormula]}</p>`;

            // Determine number of questions based on mode
            const numQuestions = currentMode === 'practice' ? 5 : 10;

            // Generate questions
            for (let i = 0; i < numQuestions; i++) {
                const question = createQuestion(currentFormula);
                currentQuestions.push(question);

                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                
                if (currentMode === 'practice') {
                    // Practice mode: show hints
                    questionDiv.innerHTML = `
                        <div class="question-header">
                            <div class="question-text">${i + 1}. ${question.text}</div>
                            <button class="hint-button" onclick="toggleHint(${i})">üí° Hint</button>
                        </div>
                        <div class="hint-box" id="hint${i}">
                            <strong>Formula:</strong> ${question.formula}<br>
                            <strong>Given:</strong> ${question.given}<br>
                            <strong>Solve for:</strong> ${question.solveFor}
                        </div>
                        <div class="answer-input">
                            <input type="number" step="0.01" id="answer${i}" placeholder="Round to 2 decimals">
                            <span class="unit">${question.unit}</span>
                        </div>
                        <div class="feedback" id="feedback${i}"></div>
                    `;
                } else {
                    // Worksheet mode: no hints
                    questionDiv.innerHTML = `
                        <div class="question-text">${i + 1}. ${question.text}</div>
                        <div class="answer-input">
                            <input type="number" step="0.01" id="answer${i}" placeholder="Round to 2 decimals">
                            <span class="unit">${question.unit}</span>
                        </div>
                        <div class="feedback" id="feedback${i}"></div>
                    `;
                }
                
                questionsContainer.appendChild(questionDiv);
            }

            questionsContainer.style.display = 'block';
            checkBtnContainer.style.display = 'block';
            
            if (currentMode === 'practice') {
                startTimer();
            }
        }

        function toggleHint(index) {
            const hintBox = document.getElementById(`hint${index}`);
            hintBox.classList.toggle('show');
        }

        function createQuestion(formula) {
            const difficulty = document.getElementById('difficulty').value;
            let question = {};

            switch(formula) {
                case 'fma':
                    const fmaType = Math.floor(Math.random() * 3);
                    if (fmaType === 0) {
                        const mass = randomByDifficulty(difficulty, 2, 50);
                        const accel = randomByDifficulty(difficulty, 2, 10);
                        const answer = mass * accel;
                        question = {
                            text: `A ${f(mass)} kg object accelerates at ${f(accel)} m/s¬≤. What force is applied?`,
                            answer: answer,
                            unit: 'N',
                            formula: 'F = ma',
                            given: `m = ${f(mass)} kg, a = ${f(accel)} m/s¬≤`,
                            solveFor: 'F (Force)',
                            steps: `F = ${f(mass)} √ó ${f(accel)} = ${f(answer)} N`
                        };
                    } else if (fmaType === 1) {
                        const force = randomByDifficulty(difficulty, 20, 200);
                        const mass = randomByDifficulty(difficulty, 5, 50);
                        const answer = force / mass;
                        question = {
                            text: `A force of ${f(force)} N is applied to a ${f(mass)} kg object. What is its acceleration?`,
                            answer: answer,
                            unit: 'm/s¬≤',
                            formula: 'F = ma, so a = F/m',
                            given: `F = ${f(force)} N, m = ${f(mass)} kg`,
                            solveFor: 'a (acceleration)',
                            steps: `a = ${f(force)} √∑ ${f(mass)} = ${f(answer)} m/s¬≤`
                        };
                    } else {
                        const force = randomByDifficulty(difficulty, 20, 200);
                        const accel = randomByDifficulty(difficulty, 2, 10);
                        const answer = force / accel;
                        question = {
                            text: `What mass object will accelerate at ${f(accel)} m/s¬≤ when a ${f(force)} N force is applied?`,
                            answer: answer,
                            unit: 'kg',
                            formula: 'F = ma, so m = F/a',
                            given: `F = ${f(force)} N, a = ${f(accel)} m/s¬≤`,
                            solveFor: 'm (mass)',
                            steps: `m = ${f(force)} √∑ ${f(accel)} = ${f(answer)} kg`
                        };
                    }
                    break;

                case 'pmv':
                    const pmvType = Math.floor(Math.random() * 3);
                    if (pmvType === 0) {
                        const mass = randomByDifficulty(difficulty, 0.5, 100);
                        const velocity = randomByDifficulty(difficulty, 5, 30);
                        question = {
                            text: `A ${mass} kg object travels at ${velocity} m/s. What is its momentum?`,
                            answer: mass * velocity,
                            unit: 'kg‚ãÖm/s',
                            formula: 'p = mv',
                            given: `m = ${mass} kg, v = ${velocity} m/s`,
                            solveFor: 'p (momentum)',
                            steps: `p = ${mass} √ó ${velocity} = ${mass * velocity} kg‚ãÖm/s`
                        };
                    } else if (pmvType === 1) {
                        const momentum = randomByDifficulty(difficulty, 100, 500);
                        const mass = randomByDifficulty(difficulty, 10, 50);
                        question = {
                            text: `An object has momentum of ${momentum} kg‚ãÖm/s and mass of ${mass} kg. Find its velocity.`,
                            answer: momentum / mass,
                            unit: 'm/s',
                            formula: 'p = mv, so v = p/m',
                            given: `p = ${momentum} kg‚ãÖm/s, m = ${mass} kg`,
                            solveFor: 'v (velocity)',
                            steps: `v = ${momentum} √∑ ${mass} = ${(momentum / mass).toFixed(2)} m/s`
                        };
                    } else {
                        const momentum = randomByDifficulty(difficulty, 100, 500);
                        const velocity = randomByDifficulty(difficulty, 5, 20);
                        question = {
                            text: `If an object's momentum is ${momentum} kg‚ãÖm/s and its velocity is ${velocity} m/s, what is its mass?`,
                            answer: momentum / velocity,
                            unit: 'kg',
                            formula: 'p = mv, so m = p/v',
                            given: `p = ${momentum} kg‚ãÖm/s, v = ${velocity} m/s`,
                            solveFor: 'm (mass)',
                            steps: `m = ${momentum} √∑ ${velocity} = ${(momentum / velocity).toFixed(2)} kg`
                        };
                    }
                    break;

                case 'dst':
                    const dstType = Math.floor(Math.random() * 3);
                    if (dstType === 0) {
                        const speed = randomByDifficulty(difficulty, 10, 50);
                        const time = randomByDifficulty(difficulty, 5, 60);
                        question = {
                            text: `An object travels at ${speed} m/s for ${time} seconds. How far does it go?`,
                            answer: speed * time,
                            unit: 'm',
                            formula: 'd = st',
                            given: `s = ${speed} m/s, t = ${time} s`,
                            solveFor: 'd (distance)',
                            steps: `d = ${speed} √ó ${time} = ${speed * time} m`
                        };
                    } else if (dstType === 1) {
                        const distance = randomByDifficulty(difficulty, 100, 1000);
                        const time = randomByDifficulty(difficulty, 5, 20);
                        question = {
                            text: `An object covers ${distance} m in ${time} seconds. What is its speed?`,
                            answer: distance / time,
                            unit: 'm/s',
                            formula: 'd = st, so s = d/t',
                            given: `d = ${distance} m, t = ${time} s`,
                            solveFor: 's (speed)',
                            steps: `s = ${distance} √∑ ${time} = ${(distance / time).toFixed(2)} m/s`
                        };
                    } else {
                        const distance = randomByDifficulty(difficulty, 100, 500);
                        const speed = randomByDifficulty(difficulty, 10, 50);
                        question = {
                            text: `How long does it take to travel ${distance} m at ${speed} m/s?`,
                            answer: distance / speed,
                            unit: 's',
                            formula: 'd = st, so t = d/s',
                            given: `d = ${distance} m, s = ${speed} m/s`,
                            solveFor: 't (time)',
                            steps: `t = ${distance} √∑ ${speed} = ${(distance / speed).toFixed(2)} s`
                        };
                    }
                    break;

                case 'vat':
                    const vatType = Math.floor(Math.random() * 3);
                    if (vatType === 0) {
                        const accel = randomByDifficulty(difficulty, 2, 15);
                        const time = randomByDifficulty(difficulty, 4, 20);
                        question = {
                            text: `An object accelerates at ${accel} m/s¬≤ for ${time} seconds. What final velocity does it reach?`,
                            answer: accel * time,
                            unit: 'm/s',
                            formula: 'v = at',
                            given: `a = ${accel} m/s¬≤, t = ${time} s`,
                            solveFor: 'v (velocity)',
                            steps: `v = ${accel} √ó ${time} = ${accel * time} m/s`
                        };
                    } else if (vatType === 1) {
                        const velocity = randomByDifficulty(difficulty, 20, 100);
                        const accel = randomByDifficulty(difficulty, 2, 10);
                        question = {
                            text: `An object reaches ${velocity} m/s after accelerating at ${accel} m/s¬≤. For how long did it accelerate?`,
                            answer: velocity / accel,
                            unit: 's',
                            formula: 'v = at, so t = v/a',
                            given: `v = ${velocity} m/s, a = ${accel} m/s¬≤`,
                            solveFor: 't (time)',
                            steps: `t = ${velocity} √∑ ${accel} = ${(velocity / accel).toFixed(2)} s`
                        };
                    } else {
                        const velocity = randomByDifficulty(difficulty, 20, 100);
                        const time = randomByDifficulty(difficulty, 4, 20);
                        question = {
                            text: `If an object's velocity increases to ${velocity} m/s after ${time} seconds, what was its acceleration?`,
                            answer: velocity / time,
                            unit: 'm/s¬≤',
                            formula: 'v = at, so a = v/t',
                            given: `v = ${velocity} m/s, t = ${time} s`,
                            solveFor: 'a (acceleration)',
                            steps: `a = ${velocity} √∑ ${time} = ${(velocity / time).toFixed(2)} m/s¬≤`
                        };
                    }
                    break;

                case 'wfd':
                    const wfdType = Math.floor(Math.random() * 3);
                    if (wfdType === 0) {
                        const force = randomByDifficulty(difficulty, 10, 100);
                        const distance = randomByDifficulty(difficulty, 5, 50);
                        question = {
                            text: `A force of ${force} N moves an object ${distance} m. How much work is done?`,
                            answer: force * distance,
                            unit: 'J',
                            formula: 'W = Fd',
                            given: `F = ${force} N, d = ${distance} m`,
                            solveFor: 'W (work)',
                            steps: `W = ${force} √ó ${distance} = ${force * distance} J`
                        };
                    } else if (wfdType === 1) {
                        const work = randomByDifficulty(difficulty, 100, 1000);
                        const distance = randomByDifficulty(difficulty, 5, 50);
                        question = {
                            text: `${work} J of work is done moving an object ${distance} m. What force was applied?`,
                            answer: work / distance,
                            unit: 'N',
                            formula: 'W = Fd, so F = W/d',
                            given: `W = ${work} J, d = ${distance} m`,
                            solveFor: 'F (force)',
                            steps: `F = ${work} √∑ ${distance} = ${(work / distance).toFixed(2)} N`
                        };
                    } else {
                        const work = randomByDifficulty(difficulty, 100, 1000);
                        const force = randomByDifficulty(difficulty, 10, 100);
                        question = {
                            text: `A force of ${force} N does ${work} J of work. How far did the object move?`,
                            answer: work / force,
                            unit: 'm',
                            formula: 'W = Fd, so d = W/F',
                            given: `W = ${work} J, F = ${force} N`,
                            solveFor: 'd (distance)',
                            steps: `d = ${work} √∑ ${force} = ${(work / force).toFixed(2)} m`
                        };
                    }
                    break;

                case 'ke':
                    const keType = Math.floor(Math.random() * 3);
                    if (keType === 0) {
                        const mass = randomByDifficulty(difficulty, 2, 50);
                        const velocity = randomByDifficulty(difficulty, 5, 30);
                        question = {
                            text: `A ${mass} kg object moves at ${velocity} m/s. What is its kinetic energy?`,
                            answer: 0.5 * mass * velocity * velocity,
                            unit: 'J',
                            formula: 'KE = ¬Ωmv¬≤',
                            given: `m = ${mass} kg, v = ${velocity} m/s`,
                            solveFor: 'KE (kinetic energy)',
                            steps: `KE = ¬Ω √ó ${mass} √ó ${velocity}¬≤ = ${(0.5 * mass * velocity * velocity).toFixed(2)} J`
                        };
                    } else if (keType === 1) {
                        const mass = randomByDifficulty(difficulty, 2, 50);
                        const ke = randomByDifficulty(difficulty, 100, 2000);
                        const velocity = Math.sqrt(2 * ke / mass);
                        question = {
                            text: `A ${mass} kg object has ${ke} J of kinetic energy. What is its velocity?`,
                            answer: velocity,
                            unit: 'm/s',
                            formula: 'KE = ¬Ωmv¬≤, so v = ‚àö(2KE/m)',
                            given: `KE = ${ke} J, m = ${mass} kg`,
                            solveFor: 'v (velocity)',
                            steps: `v = ‚àö(2 √ó ${ke} √∑ ${mass}) = ${velocity.toFixed(2)} m/s`
                        };
                    } else {
                        const ke = randomByDifficulty(difficulty, 100, 2000);
                        const velocity = randomByDifficulty(difficulty, 5, 30);
                        question = {
                            text: `An object moving at ${velocity} m/s has ${ke} J of kinetic energy. What is its mass?`,
                            answer: (2 * ke) / (velocity * velocity),
                            unit: 'kg',
                            formula: 'KE = ¬Ωmv¬≤, so m = 2KE/v¬≤',
                            given: `KE = ${ke} J, v = ${velocity} m/s`,
                            solveFor: 'm (mass)',
                            steps: `m = 2 √ó ${ke} √∑ ${velocity}¬≤ = ${((2 * ke) / (velocity * velocity)).toFixed(2)} kg`
                        };
                    }
                    break;

                case 'pe':
                    const peType = Math.floor(Math.random() * 3);
                    if (peType === 0) {
                        const mass = randomByDifficulty(difficulty, 5, 100);
                        const height = randomByDifficulty(difficulty, 2, 50);
                        question = {
                            text: `A ${mass} kg object is ${height} m above the ground. What is its potential energy? (Use g = 10 m/s¬≤)`,
                            answer: mass * 10 * height,
                            unit: 'J',
                            formula: 'PE = mgh',
                            given: `m = ${mass} kg, g = 10 m/s¬≤, h = ${height} m`,
                            solveFor: 'PE (potential energy)',
                            steps: `PE = ${mass} √ó 10 √ó ${height} = ${mass * 10 * height} J`
                        };
                    } else if (peType === 1) {
                        const mass = randomByDifficulty(difficulty, 5, 100);
                        const pe = randomByDifficulty(difficulty, 500, 5000);
                        question = {
                            text: `A ${mass} kg object has ${pe} J of potential energy. How high is it? (Use g = 10 m/s¬≤)`,
                            answer: pe / (mass * 10),
                            unit: 'm',
                            formula: 'PE = mgh, so h = PE/(mg)',
                            given: `PE = ${pe} J, m = ${mass} kg, g = 10 m/s¬≤`,
                            solveFor: 'h (height)',
                            steps: `h = ${pe} √∑ (${mass} √ó 10) = ${(pe / (mass * 10)).toFixed(2)} m`
                        };
                    } else {
                        const pe = randomByDifficulty(difficulty, 500, 5000);
                        const height = randomByDifficulty(difficulty, 2, 50);
                        question = {
                            text: `An object at ${height} m height has ${pe} J of potential energy. What is its mass? (Use g = 10 m/s¬≤)`,
                            answer: pe / (10 * height),
                            unit: 'kg',
                            formula: 'PE = mgh, so m = PE/(gh)',
                            given: `PE = ${pe} J, g = 10 m/s¬≤, h = ${height} m`,
                            solveFor: 'm (mass)',
                            steps: `m = ${pe} √∑ (10 √ó ${height}) = ${(pe / (10 * height)).toFixed(2)} kg`
                        };
                    }
                    break;

                case 'pwt':
                    const pwtType = Math.floor(Math.random() * 3);
                    if (pwtType === 0) {
                        const work = randomByDifficulty(difficulty, 100, 1000);
                        const time = randomByDifficulty(difficulty, 2, 20);
                        question = {
                            text: `${work} J of work is done in ${time} seconds. What is the power?`,
                            answer: work / time,
                            unit: 'W',
                            formula: 'P = W/t',
                            given: `W = ${work} J, t = ${time} s`,
                            solveFor: 'P (power)',
                            steps: `P = ${work} √∑ ${time} = ${(work / time).toFixed(2)} W`
                        };
                    } else if (pwtType === 1) {
                        const power = randomByDifficulty(difficulty, 50, 500);
                        const time = randomByDifficulty(difficulty, 2, 20);
                        question = {
                            text: `A machine with ${power} W of power operates for ${time} seconds. How much work is done?`,
                            answer: power * time,
                            unit: 'J',
                            formula: 'P = W/t, so W = Pt',
                            given: `P = ${power} W, t = ${time} s`,
                            solveFor: 'W (work)',
                            steps: `W = ${power} √ó ${time} = ${power * time} J`
                        };
                    } else {
                        const work = randomByDifficulty(difficulty, 100, 1000);
                        const power = randomByDifficulty(difficulty, 50, 500);
                        question = {
                            text: `How long does it take for a ${power} W machine to do ${work} J of work?`,
                            answer: work / power,
                            unit: 's',
                            formula: 'P = W/t, so t = W/P',
                            given: `W = ${work} J, P = ${power} W`,
                            solveFor: 't (time)',
                            steps: `t = ${work} √∑ ${power} = ${(work / power).toFixed(2)} s`
                        };
                    }
                    break;

                case 'advt':
                    const advtType = Math.floor(Math.random() * 3);
                    if (advtType === 0) {
                        const deltaV = randomByDifficulty(difficulty, 10, 60);
                        const time = randomByDifficulty(difficulty, 2, 10);
                        question = {
                            text: `An object's velocity changes by ${deltaV} m/s in ${time} seconds. What is its acceleration?`,
                            answer: deltaV / time,
                            unit: 'm/s¬≤',
                            formula: 'a = Œîv/t',
                            given: `Œîv = ${deltaV} m/s, t = ${time} s`,
                            solveFor: 'a (acceleration)',
                            steps: `a = ${deltaV} √∑ ${time} = ${(deltaV / time).toFixed(2)} m/s¬≤`
                        };
                    } else if (advtType === 1) {
                        const accel = randomByDifficulty(difficulty, 2, 10);
                        const time = randomByDifficulty(difficulty, 2, 10);
                        question = {
                            text: `An object accelerates at ${accel} m/s¬≤ for ${time} seconds. What is the change in velocity?`,
                            answer: accel * time,
                            unit: 'm/s',
                            formula: 'a = Œîv/t, so Œîv = at',
                            given: `a = ${accel} m/s¬≤, t = ${time} s`,
                            solveFor: 'Œîv (change in velocity)',
                            steps: `Œîv = ${accel} √ó ${time} = ${accel * time} m/s`
                        };
                    } else {
                        const deltaV = randomByDifficulty(difficulty, 10, 60);
                        const accel = randomByDifficulty(difficulty, 2, 10);
                        question = {
                            text: `How long does it take for velocity to change by ${deltaV} m/s with an acceleration of ${accel} m/s¬≤?`,
                            answer: deltaV / accel,
                            unit: 's',
                            formula: 'a = Œîv/t, so t = Œîv/a',
                            given: `Œîv = ${deltaV} m/s, a = ${accel} m/s¬≤`,
                            solveFor: 't (time)',
                            steps: `t = ${deltaV} √∑ ${accel} = ${(deltaV / accel).toFixed(2)} s`
                        };
                    }
                    break;

                case 'density':
                    const densityType = Math.floor(Math.random() * 3);
                    if (densityType === 0) {
                        const mass = randomByDifficulty(difficulty, 100, 1000);
                        const volume = randomByDifficulty(difficulty, 10, 100);
                        question = {
                            text: `An object has a mass of ${mass} g and a volume of ${volume} cm¬≥. What is its density?`,
                            answer: mass / volume,
                            unit: 'g/cm¬≥',
                            formula: 'œÅ = m/V',
                            given: `m = ${mass} g, V = ${volume} cm¬≥`,
                            solveFor: 'œÅ (density)',
                            steps: `œÅ = ${mass} √∑ ${volume} = ${(mass / volume).toFixed(2)} g/cm¬≥`
                        };
                    } else if (densityType === 1) {
                        const density = randomByDifficulty(difficulty, 0.5, 20);
                        const volume = randomByDifficulty(difficulty, 10, 100);
                        question = {
                            text: `An object has a density of ${density} g/cm¬≥ and a volume of ${volume} cm¬≥. What is its mass?`,
                            answer: density * volume,
                            unit: 'g',
                            formula: 'œÅ = m/V, so m = œÅV',
                            given: `œÅ = ${density} g/cm¬≥, V = ${volume} cm¬≥`,
                            solveFor: 'm (mass)',
                            steps: `m = ${density} √ó ${volume} = ${(density * volume).toFixed(2)} g`
                        };
                    } else {
                        const mass = randomByDifficulty(difficulty, 100, 1000);
                        const density = randomByDifficulty(difficulty, 0.5, 20);
                        question = {
                            text: `An object has a mass of ${mass} g and a density of ${density} g/cm¬≥. What is its volume?`,
                            answer: mass / density,
                            unit: 'cm¬≥',
                            formula: 'œÅ = m/V, so V = m/œÅ',
                            given: `m = ${mass} g, œÅ = ${density} g/cm¬≥`,
                            solveFor: 'V (volume)',
                            steps: `V = ${mass} √∑ ${density} = ${(mass / density).toFixed(2)} cm¬≥`
                        };
                    }
                    break;

                case 'wave':
                    const waveType = Math.floor(Math.random() * 3);
                    if (waveType === 0) {
                        const frequency = randomByDifficulty(difficulty, 50, 500);
                        const wavelength = randomByDifficulty(difficulty, 0.5, 10);
                        question = {
                            text: `A wave has a frequency of ${frequency} Hz and a wavelength of ${wavelength} m. What is its speed?`,
                            answer: frequency * wavelength,
                            unit: 'm/s',
                            formula: 'v = fŒª',
                            given: `f = ${frequency} Hz, Œª = ${wavelength} m`,
                            solveFor: 'v (wave speed)',
                            steps: `v = ${frequency} √ó ${wavelength} = ${frequency * wavelength} m/s`
                        };
                    } else if (waveType === 1) {
                        const speed = randomByDifficulty(difficulty, 300, 3000);
                        const wavelength = randomByDifficulty(difficulty, 0.5, 10);
                        question = {
                            text: `A wave travels at ${speed} m/s with a wavelength of ${wavelength} m. What is its frequency?`,
                            answer: speed / wavelength,
                            unit: 'Hz',
                            formula: 'v = fŒª, so f = v/Œª',
                            given: `v = ${speed} m/s, Œª = ${wavelength} m`,
                            solveFor: 'f (frequency)',
                            steps: `f = ${speed} √∑ ${wavelength} = ${(speed / wavelength).toFixed(2)} Hz`
                        };
                    } else {
                        const speed = randomByDifficulty(difficulty, 300, 3000);
                        const frequency = randomByDifficulty(difficulty, 50, 500);
                        question = {
                            text: `A wave travels at ${speed} m/s with a frequency of ${frequency} Hz. What is its wavelength?`,
                            answer: speed / frequency,
                            unit: 'm',
                            formula: 'v = fŒª, so Œª = v/f',
                            given: `v = ${speed} m/s, f = ${frequency} Hz`,
                            solveFor: 'Œª (wavelength)',
                            steps: `Œª = ${speed} √∑ ${frequency} = ${(speed / frequency).toFixed(2)} m`
                        };
                    }
                    break;

                case 'period':
                    const periodType = Math.floor(Math.random() * 2);
                    if (periodType === 0) {
                        const frequency = randomByDifficulty(difficulty, 2, 100);
                        question = {
                            text: `A wave has a frequency of ${frequency} Hz. What is its period?`,
                            answer: 1 / frequency,
                            unit: 's',
                            formula: 'T = 1/f',
                            given: `f = ${frequency} Hz`,
                            solveFor: 'T (period)',
                            steps: `T = 1 √∑ ${frequency} = ${(1 / frequency).toFixed(4)} s`
                        };
                    } else {
                        const period = randomByDifficulty(difficulty, 0.01, 1);
                        question = {
                            text: `A wave has a period of ${period} s. What is its frequency?`,
                            answer: 1 / period,
                            unit: 'Hz',
                            formula: 'T = 1/f, so f = 1/T',
                            given: `T = ${period} s`,
                            solveFor: 'f (frequency)',
                            steps: `f = 1 √∑ ${period} = ${(1 / period).toFixed(2)} Hz`
                        };
                    }
                    break;
            }

            return question;
        }

        function randomByDifficulty(difficulty, min, max) {
            if (difficulty === 'easy') {
                // Whole numbers only
                return Math.floor(Math.random() * (max - min + 1)) + min;
            } else if (difficulty === 'medium') {
                // Numbers with up to 1 decimal place
                const num = Math.random() * (max - min) + min;
                return Math.round(num * 10) / 10;
            } else {
                // Hard: any decimal, including fractions
                const num = Math.random() * (max - min) + min;
                return Math.round(num * 100) / 100;
            }
        }

        // Helper function to format numbers to 2 decimal places
        function f(num) {
            return Number(num).toFixed(2);
        }

        function generateUnitsQuestions() {
            const unitsBank = [
                { quantity: 'Force', unit: 'N', wrongUnits: ['kg', 'm/s', 'J'] },
                { quantity: 'Mass', unit: 'kg', wrongUnits: ['N', 'm/s', 'g/cm¬≥'] },
                { quantity: 'Acceleration', unit: 'm/s¬≤', wrongUnits: ['m/s', 'N', 'Hz'] },
                { quantity: 'Velocity', unit: 'm/s', wrongUnits: ['m/s¬≤', 'Hz', 'N'] },
                { quantity: 'Distance', unit: 'm', wrongUnits: ['s', 'm/s', 'cm¬≥'] },
                { quantity: 'Time', unit: 's', wrongUnits: ['m', 'Hz', 'N'] },
                { quantity: 'Work', unit: 'J', wrongUnits: ['W', 'N', 'kg'] },
                { quantity: 'Power', unit: 'W', wrongUnits: ['J', 'N', 's'] },
                { quantity: 'Momentum', unit: 'kg‚ãÖm/s', wrongUnits: ['N', 'J', 'm/s'] },
                { quantity: 'Kinetic Energy', unit: 'J', wrongUnits: ['W', 'N', 'kg'] },
                { quantity: 'Potential Energy', unit: 'J', wrongUnits: ['W', 'N', 'kg'] },
                { quantity: 'Density', unit: 'g/cm¬≥', wrongUnits: ['kg', 'cm¬≥', 'kg/m¬≥'] },
                { quantity: 'Frequency', unit: 'Hz', wrongUnits: ['s', 'm', 'm/s'] },
                { quantity: 'Period', unit: 's', wrongUnits: ['Hz', 'm', 'N'] },
                { quantity: 'Wavelength', unit: 'm', wrongUnits: ['Hz', 's', 'm/s'] },
                { quantity: 'Wave Speed', unit: 'm/s', wrongUnits: ['Hz', 'm', 's'] }
            ];

            // Shuffle and take 10 questions
            const shuffled = unitsBank.sort(() => Math.random() - 0.5);
            const selected = shuffled.slice(0, 10);

            currentQuestions = selected.map(q => ({
                ...q,
                userAnswer: null
            }));

            const questionsContainer = document.getElementById('questionsContainer');
            const checkBtnContainer = document.getElementById('checkBtnContainer');

            selected.forEach((q, i) => {
                const allUnits = [q.unit, ...q.wrongUnits].sort(() => Math.random() - 0.5);
                
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <div class="question-text">${i + 1}. What is the SI unit for ${q.quantity}?</div>
                    <div class="units-choices" id="choices${i}">
                        ${allUnits.map(unit => `
                            <div class="unit-choice" onclick="selectUnit(${i}, '${unit}')" data-unit="${unit}">
                                ${unit}
                            </div>
                        `).join('')}
                    </div>
                    <div class="feedback" id="feedback${i}"></div>
                `;
                questionsContainer.appendChild(questionDiv);
            });

            questionsContainer.style.display = 'block';
            checkBtnContainer.style.display = 'block';
        }

        function selectUnit(questionIndex, selectedUnit) {
            // Remove previous selection
            const choices = document.querySelectorAll(`#choices${questionIndex} .unit-choice`);
            choices.forEach(choice => choice.classList.remove('selected'));

            // Mark new selection
            const selectedChoice = document.querySelector(`#choices${questionIndex} .unit-choice[data-unit="${selectedUnit}"]`);
            if (selectedChoice) {
                selectedChoice.classList.add('selected');
            }

            // Store answer
            currentQuestions[questionIndex].userAnswer = selectedUnit;
        }

        function checkAnswers() {
            let correct = 0;
            stopTimer();

            if (currentMode === 'units') {
                // Check units questions
                for (let i = 0; i < currentQuestions.length; i++) {
                    const q = currentQuestions[i];
                    const feedback = document.getElementById(`feedback${i}`);
                    const choices = document.querySelectorAll(`#choices${i} .unit-choice`);

                    stats.questionsToday++;

                    if (!q.userAnswer) {
                        feedback.className = 'feedback incorrect';
                        feedback.textContent = 'Please select an answer';
                    } else if (q.userAnswer === q.unit) {
                        feedback.className = 'feedback correct';
                        feedback.textContent = '‚úì Correct!';
                        correct++;
                        stats.correctToday++;
                        
                        // Mark correct choice green
                        choices.forEach(choice => {
                            if (choice.dataset.unit === q.unit) {
                                choice.classList.add('correct');
                            }
                        });
                    } else {
                        feedback.className = 'feedback incorrect';
                        feedback.textContent = `‚úó Incorrect. The correct unit is ${q.unit}`;
                        
                        // Mark wrong choice red, correct choice green
                        choices.forEach(choice => {
                            if (choice.dataset.unit === q.userAnswer) {
                                choice.classList.add('incorrect');
                            } else if (choice.dataset.unit === q.unit) {
                                choice.classList.add('correct');
                            }
                        });
                    }
                }

                saveStats();
                updateStatsDisplay();

                const scoreContainer = document.getElementById('scoreContainer');
                const scoreElement = document.getElementById('score');
                scoreElement.textContent = `${correct} / 10`;
                scoreContainer.style.display = 'block';
                scoreContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                return;
            }
            
            // Regular formula questions
            for (let i = 0; i < currentQuestions.length; i++) {
                const userAnswer = parseFloat(document.getElementById(`answer${i}`).value);
                const correctAnswer = currentQuestions[i].answer;
                const feedback = document.getElementById(`feedback${i}`);

                stats.questionsToday++;

                if (isNaN(userAnswer)) {
                    feedback.className = 'feedback incorrect';
                    feedback.textContent = 'Please enter an answer';
                } else if (Math.abs(userAnswer - correctAnswer) < 0.1) {
                    feedback.className = 'feedback correct';
                    feedback.textContent = '‚úì Correct!';
                    correct++;
                    stats.correctToday++;
                } else {
                    feedback.className = 'feedback incorrect';
                    feedback.innerHTML = `‚úó Incorrect. The correct answer is ${correctAnswer.toFixed(2)} ${currentQuestions[i].unit}<br><strong>Steps:</strong> ${currentQuestions[i].steps}`;
                }
            }

            saveStats();
            updateStatsDisplay();

            const scoreContainer = document.getElementById('scoreContainer');
            const scoreElement = document.getElementById('score');
            const total = currentMode === 'practice' ? 5 : 10;
            scoreElement.textContent = `${correct} / ${total}`;
            scoreContainer.style.display = 'block';

            scoreContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function printWorksheet() {
            const formulaSelect = document.getElementById('formula');
            currentFormula = formulaSelect.value;

            if (!currentFormula) {
                alert('Please select a formula first!');
                return;
            }

            // Generate 10 questions for worksheet
            const worksheetQuestions = [];
            for (let i = 0; i < 10; i++) {
                worksheetQuestions.push(createQuestion(currentFormula));
            }

            // Create printable content in the same page
            const originalContent = document.body.innerHTML;
            
            const worksheetHTML = `
                <div style="font-family: Arial, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto;">
                    <h1 style="color: #667eea;">Physics Formula Practice Worksheet</h1>
                    <div style="margin-bottom: 30px;">
                        <p><strong>Name:</strong> _________________________</p>
                        <p><strong>Date:</strong> _________________________</p>
                        <p><strong>Formula:</strong> ${document.getElementById('formula').options[document.getElementById('formula').selectedIndex].text}</p>
                    </div>
                    ${worksheetQuestions.map((q, i) => `
                        <div style="margin-bottom: 30px;">
                            <p><strong>${i + 1}.</strong> ${q.text}</p>
                            <p>Answer: _________________ ${q.unit}</p>
                        </div>
                    `).join('')}
                    <div style="page-break-before: always; margin-top: 50px;">
                        <h2>Answer Key</h2>
                        ${worksheetQuestions.map((q, i) => `
                            <p><strong>${i + 1}.</strong> ${q.answer.toFixed(2)} ${q.unit}</p>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.body.innerHTML = worksheetHTML;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Reload stats after restoring content
            loadStats();
        }

        // Load stats on page load
        loadStats();
    </script>
</body>
</html>
